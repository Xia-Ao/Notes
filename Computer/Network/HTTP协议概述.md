
# HTTP协议

HTTP协议即超文本传送协议Hypertext Transfer Protocol，是Web联网的基础，也是手机联网常用的协议之一，HTTP协议是建立在TCP协议之上的一种应用。  
HTTP连接最显著的特点是**客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接**。从建立连接到关闭连接的过程称为“一次连接”。  
1）在HTTP 1.0中，客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。

2）在HTTP 1.1中则可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。

### HTTP协议发展历史
关于HTTP协议从HTTP0.9 - HTTP2.0，中间经历的HTTP1.0 ，HTTP1.1，目前主流使用的是HTTP1.1， 部分网站例如Google等已经使用了HTTP2.0，以及HTTP2.0的前身spdy。阮一峰老师的的[HTTP 协议入门](http://www.ruanyifeng.com/blog/2016/08/http.html)一文介绍了HTTP各个版本协议的特点以及相对上一个版本新增内容

#### http/0.9

- HTTP 是基于 TCP/IP 协议的应用层协议。它不涉及数据包（packet）传输，主要规定了客户端和服务器之间的通信格式，默认使用80端口。
- 只有`GET`请求
- 协议规定，服务器只能回应HTML格式的字符串，不能回应别的格式。
- 服务器发送完毕，就关闭TCP连接。

#### http/1.0

- 任何格式的内容都可以发送。这使得互联网不仅可以传输文字，还能传输图像、视频、二进制文件。这为互联网的大发展奠定了基础。
- 除了GET命令，还引入了`POST`命令和`HEAD`命令，丰富了浏览器与服务器的互动手段。
- HTTP请求和回应的格式也变了。除了数据部分，每次通信都必须包括头信息（HTTP header），用来描述一些元数据。
- 其他的新增功能还包括状态码（`status code`）、多字符集支持、多部分发送（multi-part type）、权限（authorization）、缓存（cache）、内容编码（`content` `encoding`）等。

**缺点：**

- 每个TCP连接只能发送一个请求。发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接。
- TCP连接的新建成本很高，因为需要客户端和服务器三次握手，并且开始时发送速率较慢（slow start）

#### http/1.1

- 引入了持久连接（persistent connection），即TCP连接默认不关闭，可以被多个请求复用，不用声明`Connection: keep-alive`
- 使用`connection: close`关闭TCP连接
- 引入了管道机制（pipelining），即在同一个TCP连接里面，客户端可以同时发送多个请求。这样就进一步改进了HTTP协议的效率。但是服务器还是要按照顺序来回应请求。
- 可以使用分块传输编码。
- 新增了许多动词方法：`PUT`、`PATCH`、 `OPTIONS`、`DELETE`。
- 客户端请求的头信息新增了`Host`字段，用来指定服务器的域名。

**缺点：**

虽然1.1版允许复用TCP连接，但是同一个TCP连接里面，所有的数据通信是按次序进行的。服务器只有处理完一个回应，才会进行下一个回应。要是前面的回应特别慢，后面就会有许多请求排队等着。这称为"队头堵塞"。

为了避免这个问题，只有两种方法：一是减少请求数，二是同时多开持久连接。

#### http/2

注意，不叫http/2.0，因为不打算发布子版本了，下一个版本应该直接是http/3

1. **二进制协议**：HTTP/2 则是一个彻底的二进制协议，头信息和数据体都是二进制，并且统称为"帧"（frame）：头信息帧和数据帧。
2. **多工**： HTTP/2 复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序一一对应，这样就避免了"队头堵塞"。
3. **数据流**：HTTP/2 将每个请求或回应的所有数据包，称为一个数据流（stream）。每个数据流都有一个独一无二的编号。数据包发送的时候，都必须标记数据流ID，用来区分它属于哪个数据流。另外还规定，客户端发出的数据流，ID一律为奇数，服务器发出的，ID为偶数。
4. **头信息压缩**：引入了头信息压缩机制（header compression）。一方面，头信息使用gzip或compress压缩后再发送；另一方面，客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号，这样就提高速度了。
5. **服务器推送**：允许服务器未经请求，主动向客户端发送资源，这叫做服务器推送

### HTTP2 服务器推送
[HTTP/2 服务器推送（Server Push）教程](http://www.ruanyifeng.com/blog/2018/03/http2_server_push.html)

### HTTP请求Methods
四种常用请求method
- GET 
- POST
- PUT 
- DELETE

**GET操作是安全的**。所谓安全是指不管进行多少次操作，资源的状态都不会改变。比如我用GET浏览文章，不管浏览多少次，那篇文章还在那，没有变化。当然，你可能说每浏览一次文章，文章的浏览数就加一，这不也改变了资源的状态么？这并不矛盾，因为这个改变不是GET操作引起的，而是用户自己设定的服务端逻辑造成的。

**PUT，DELETE操作是幂等的**。所谓幂等是指不管进行多少次操作，结果都一样。比如我用PUT修改一篇文章，然后在做同样的操作，每次操作后的结果并没有不同，DELETE也是一样。顺便说一句，因为GET操作是安全的，所以它自然也是幂等的。

**POST操作既不是安全的，也不是幂等的**，比如常见的POST重复加载问题：当我们多次发出同样的POST请求后，其结果是创建出了若干的资源。  

**安全和幂等的意义在于**：当操作没有达到预期的目标时，我们可以不停的重试，而不会对资源产生副作用。从这个意义上说，POST操作往往是有害的，但很多时候我们还是不得不使用它。

参考：
- [HTTP协议概述](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview)
- [99%的人都理解错了 HTTP 中 GET 与 POST 的区别](https://learnku.com/articles/25881)