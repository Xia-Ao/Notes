
# webpack äº†è§£ä¸åŸºæœ¬é…ç½®

- èƒŒæ™¯
  - æ‰“åŒ…å·¥å…·å¯¹æ¯” 
  - webpackç‰ˆæœ¬å¯¹æ¯”ï¼ˆwebpack5ï¼‰ï¼ˆç¨‹åº¦è§†åŸºç¡€èƒ½åŠ›è€Œå®šï¼‰
    - ä¸ºä»€ä¹ˆæœ‰è¿™äº›å˜åŒ–ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ 
  - åŸºæœ¬é…ç½®
    - entry out loader plugin
    - æ–‡ä»¶æŒ‡çº¹



## æ‰“åŒ…å·¥å…·å¯¹æ¯”

### FIS3
ä¸€å¼€å§‹FIS3æ˜¯ç™¾åº¦å¼€å‘å‡ºæ¥ç»™è‡ªå·±ç”¨çš„ï¼Œå®˜ç½‘å®šä¹‰: 
> è§£å†³å‰ç«¯å·¥ç¨‹ä¸­æ€§èƒ½ä¼˜åŒ–ã€èµ„æºåŠ è½½ï¼ˆå¼‚æ­¥ã€åŒæ­¥ã€æŒ‰éœ€ã€é¢„åŠ è½½ã€ä¾èµ–ç®¡ç†ã€åˆå¹¶ã€å†…åµŒï¼‰ã€æ¨¡å—åŒ–å¼€å‘ã€è‡ªåŠ¨åŒ–å·¥å…·ã€å¼€å‘è§„èŒƒã€ä»£ç éƒ¨ç½²ç­‰é—®é¢˜ã€‚

#### æ„å»ºåŸç†
FIS3æ˜¯åŸºäºæ–‡ä»¶å¯¹è±¡è¿›è¡Œæ„å»ºçš„ï¼Œæ¯ä¸ªè¿›å…¥ FIS3 çš„æ–‡ä»¶éƒ½ä¼šå®ä¾‹åŒ–æˆä¸€ä¸ª File å¯¹è±¡ï¼Œæ•´ä¸ªæ„å»ºè¿‡ç¨‹éƒ½å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œå®Œæˆæ„å»ºä»»åŠ¡


æµç¨‹ï¼š

![image](https://raw.githubusercontent.com/fex-team/fis3/master/doc/docs/api/img/fis-compile-flow.png)

1. æ‰«æé¡¹ç›®ç›®å½•æ‹¿åˆ°æ–‡ä»¶å¹¶åˆå§‹åŒ–å‡ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡åˆ—è¡¨
1. å¯¹æ–‡ä»¶å¯¹è±¡ä¸­æ¯ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå•æ–‡ä»¶ç¼–è¯‘
1. è·å–ç”¨æˆ·è®¾ç½®çš„ package æ’ä»¶ï¼Œè¿›è¡Œæ‰“åŒ…å¤„ç†ï¼ˆåŒ…æ‹¬åˆå¹¶å›¾ç‰‡ï¼‰

å•æ–‡ä»¶ç¼–è¯‘çš„è¿‡ç¨‹
- lintï¼šä»£ç æ ¡éªŒæ£€æŸ¥ï¼Œæ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥éœ€è¦ release å‘½ä»¤å‘½ä»¤è¡Œæ·»åŠ  -l å‚æ•°
- parserï¼šé¢„å¤„ç†é˜¶æ®µï¼Œæ¯”å¦‚ lessã€sassã€es6ã€react å‰ç«¯æ¨¡æ¿ç­‰éƒ½åœ¨æ­¤å¤„é¢„ç¼–è¯‘å¤„ç†
- preprocessorï¼šæ ‡å‡†åŒ–å‰å¤„ç†æ’ä»¶
- standardï¼šæ ‡å‡†åŒ–æ’ä»¶ï¼Œå¤„ç†å†…ç½®è¯­æ³•
- postprocessorï¼šæ ‡å‡†åŒ–åå¤„ç†æ’ä»¶

æ–‡ä»¶æ‰“åŒ…çš„è¿‡ç¨‹ï¼š
- prepackager æ‰“åŒ…å‰å¤„ç†æ’ä»¶æ‰©å±•ç‚¹
- packager æ‰“åŒ…æ’ä»¶æ‰©å±•ç‚¹ï¼Œé€šè¿‡æ­¤æ’ä»¶æ”¶é›†æ–‡ä»¶ä¾èµ–ä¿¡æ¯ã€åˆå¹¶ä¿¡æ¯äº§å‡ºé™æ€èµ„æºæ˜ å°„è¡¨
- spriter å›¾ç‰‡åˆå¹¶æ‰©å±•ç‚¹ï¼Œå¦‚ csssprites
- postpackager æ‰“åŒ…åå¤„ç†æ’ä»¶æ‰©å±•ç‚¹

æ„å»ºè¿‡ç¨‹ä¼šåˆ†ææ¯ä¸€ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œç”Ÿæˆä¸€ä¸ªèµ„æºè¡¨`sourceMap`ï¼Œèµ„æºè¡¨è®°å½•æ¯ä¸€ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠå‘å¸ƒå‰çš„ä½ç½®ï¼Œå’Œå‘å¸ƒåçš„å»å‘ã€‚


##### å†…å®¹åµŒå…¥
FIS3 æ”¯æŒä¸€ç§å†…ç½®è¯­æ³•ï¼Œå¯ä»¥é€šè¿‡`?__inline`æ ‡è®°å°†èµ„æºåµŒå…¥htmlã€cssã€jsä¸­ï¼Œ

```html
// æºç 
<link rel="stylesheet" type="text/css" href="demo.css?__inline">

// ç¼–è¯‘å
 <style>img { border: 5px solid #ccc; }</style>
```

#### ç‰¹ç‚¹
ä¼˜ç‚¹ï¼š

- FIS3éå¸¸çµæ´»ï¼Œå› ä¸ºåªæ”¶é›†æ–‡ä»¶çš„å„ç§ä¾èµ–å…³ç³»ï¼Œä¸é™åˆ¶ä¸€ä¸ªè¾“å…¥è¾“å‡ºï¼Œå¯ä»¥æ ¹æ®sourceMapè‡ªå®šä¹‰è¾“å‡ºè§„åˆ™ã€‚
- é€‚åˆå¤šé¡µé¢æ‰“åŒ…
- fisä¸ä½†èƒ½é€šè¿‡requireï¼Œimportç­‰æŸ¥æ‰¾ä¾èµ–ï¼Œè€Œä¸”ä¼šæœå¯»srcï¼Œhrefç­‰å„å¤„ä¸èµ„æºå®šä½æœ‰å…³çš„åœ°æ–¹ï¼Œå°†ä»–ä»¬è®¡å…¥ä¾èµ–åˆ—è¡¨ã€‚

ç¼ºç‚¹
- å›½äº§ï¼Œç»´æŠ¤ä¸è¿…é€Ÿ
- æ’ä»¶æ²¡æœ‰webpackå¤š

### gulp

gulpæ˜¯åŸºäºnodeJSçš„ä¸¤ä¸ªé‡è¦æ¨¡å—ï¼šFileSystem å’ŒTransform Stream å®ç°å¯¹æ–‡ä»¶å’Œæ•°æ®æµçš„æ“ä½œï¼Œå¹¶ä¸”å€Ÿé‰´äº†Unixçš„ç®¡é“ï¼ˆpipeï¼‰çš„æ€æƒ³ï¼Œä½¿å¾—å¤„ç†è¿‡çš„å¯¹è±¡ä»ä¸Šä¸€ä¸ªæµå®‰å…¨çš„æµå…¥ä¸‹ä¸€ä¸ªæµã€‚ä½†æ˜¯Gulpæ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œè€Œæ˜¯åœ¨FileSystem å’ŒTransform Streamçš„ä¸Šé¢åŒ…è£…äº†ä¸€å±‚vinylï¼Œä½¿æµçš„æ“ä½œæ›´åŠ ç®€å•ã€‚

#### æµå¼å¤„ç†

- srcæ˜¯è¾“å…¥
- destæ˜¯è¾“å‡º

```js
var gulp = require('gulp');
var uglify = require('gulp-uglify');

gulp.task('default', function() {
    gulp.src('src/*.js')
        .pipe(uglify())   //å‹ç¼©js
        .pipe(gulp.dest('dist'))
});
```

æ¯ä¸ªç‹¬ç«‹æ“ä½œå•å…ƒéƒ½æ˜¯ä¸€ä¸ªtaskï¼Œä½¿ç”¨pipeæ¥ç»„è£…tasks


### Rollup.js

**Tree-shaking**

è¿™ä¸ªç‰¹ç‚¹ï¼Œæ˜¯Rollupæœ€åˆæ¨å‡ºæ—¶çš„ä¸€å¤§ç‰¹ç‚¹ã€‚Rollupé€šè¿‡å¯¹ä»£ç çš„é™æ€åˆ†æï¼Œåˆ†æå‡ºå†—ä½™ä»£ç ï¼Œåœ¨æœ€ç»ˆçš„æ‰“åŒ…æ–‡ä»¶ä¸­å°†è¿™äº›å†—ä½™ä»£ç åˆ é™¤æ‰ï¼Œè¿›ä¸€æ­¥ç¼©å°ä»£ç ä½“ç§¯ã€‚è¿™æ˜¯ç›®å‰å¤§éƒ¨åˆ†æ„å»ºå·¥å…·æ‰€ä¸å…·å¤‡çš„ç‰¹ç‚¹



**ES6**

RollupåŸºäºES6ï¼Œå¯ä»¥æ˜¯ç”¨ES6çš„importè¯­æ³•ï¼Œä¸ç”¨ç®¡æ¨¡å—è§„èŒƒæ˜¯ CommonJS è¿˜æ˜¯ AMDï¼ŒES6 æ¨¡å—å¯ä»¥ä½¿ä½ è‡ªç”±ã€æ— ç¼åœ°ä½¿ç”¨ä½ æœ€å–œçˆ±çš„ library ä¸­é‚£äº›æœ€æœ‰ç”¨ç‹¬ç«‹å‡½æ•°ï¼Œè€Œä½ çš„é¡¹ç›®ä¸å¿…æºå¸¦å…¶ä»–æœªä½¿ç”¨çš„ä»£ç 

ä¸ç”¨ä½¿ç”¨babelç­‰è½¬æˆES5ï¼ˆè¿è¡Œç¯å¢ƒæ”¯æŒES6ï¼Œä¸€èˆ¬ä¸ºåŸºç¡€åº“ï¼‰

![](https://pic4.zhimg.com/80/v2-87a1817d027f5e000b80ada132e11b33_hd.jpg)


![](https://pic2.zhimg.com/80/v2-cd8913573d1862aa0799b28ca84e048d_hd.jpg)

### parcel

æ¥è‡ªç½‘ä¸Šçš„ä¸€ä¸ªæ¯”å–»ï¼šåœ¨ç”¨äº†å¾ˆä¹… Webpack åç”¨ Parcel çš„æ„Ÿè§‰å°±åƒç”¨äº†å¾ˆä¹… Android æœºåç”¨ iPhoneï¼Œä¸ç”¨å†å»æ“å¿ƒç»†èŠ‚å’Œé…ç½®ï¼Œå¤§å¤šæ•°æ—¶å€™ Parcel åˆšåˆšå¤Ÿç”¨è€Œä¸”ç”¨çš„å¾ˆèˆ’æœã€‚

> Parcel æ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åº æ‰“åŒ…å™¨(bundler) ï¼Œä¸ä»¥å¾€çš„å¼€å‘äººå‘˜ä½¿ç”¨çš„æ‰“åŒ…å™¨æœ‰æ‰€ä¸åŒã€‚å®ƒåˆ©ç”¨å¤šæ ¸å¤„ç†æä¾›æå¿«çš„æ€§èƒ½ï¼Œå¹¶ä¸”ä½ ä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®ã€‚

> Parcel åŸºäºèµ„æºçš„ã€‚èµ„æºå¯ä»¥ä»£è¡¨ä»»ä½•æ–‡ä»¶ï¼Œä½† Parcel å¯¹ JavaScript ï¼ŒCSS å’Œ HTML æ–‡ä»¶ç­‰ç‰¹å®šç±»å‹çš„èµ„æºæœ‰ç‰¹æ®Šçš„æ”¯æŒã€‚Parcel è‡ªåŠ¨åˆ†æè¿™äº›æ–‡ä»¶ä¸­å¼•ç”¨çš„ä¾èµ–å…³ç³»ï¼Œå¹¶å°†å…¶åŒ…å«åˆ° è¾“å‡ºåŒ…(output bundle) ä¸­ã€‚ç›¸ä¼¼ç±»å‹çš„èµ„æºè¢«ç»„åˆåœ¨ä¸€èµ·æˆä¸ºç›¸åŒçš„è¾“å‡ºåŒ…ã€‚å¦‚æœæ‚¨å¯¼å…¥ä¸åŒç±»å‹çš„èµ„æºï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ JS ä¸­å¯¼å…¥äº†ä¸€ä¸ª CSS æ–‡ä»¶ï¼‰ï¼Œå®ƒæ–°å»ºä¸€ä¸ªå­åŒ…ï¼Œå¹¶åœ¨çˆ¶çº§ä¸­ä¿ç•™ä¸€ä¸ªå¼•ç”¨ã€‚è¿™å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­è¿›è¡Œä¸¾ä¾‹è¯´æ˜ã€‚

æ‰“åŒ…è¿‡ç¨‹ï¼š

1ã€ æ„å»ºèµ„æºæ ‘
Parcel æ¥å—å•ä¸ªå…¥å£èµ„æºä½œä¸ºè¾“å…¥ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼šJSæ–‡ä»¶ï¼ŒHTMLï¼ŒCSSï¼Œå›¾åƒç­‰ã€‚åœ¨Parcel ä¸­å®šä¹‰äº†å„ç§èµ„æºç±»å‹ï¼Œå®ƒä»¬çŸ¥é“å¦‚ä½•å¤„ç†ç‰¹å®šçš„æ–‡ä»¶ç±»å‹ã€‚ èµ„æºè¢«è§£æï¼Œä»–ä»¬çš„ä¾èµ–å…³ç³»è¢«æå–ï¼Œå¹¶è¢«è½¬æ¢æˆæœ€ç»ˆçš„ç¼–è¯‘å½¢å¼ã€‚ è¿™ä¸ªè¿‡ç¨‹åˆ›å»ºäº†ä¸€ä¸ªèµ„æºæ ‘ã€‚

2ã€æ„å»ºæ‰“åŒ…æ ‘

ä¸€æ—¦èµ„æºæ ‘æ„å»ºå®Œæˆï¼Œèµ„æºå°±è¢«æ”¾å…¥æ‰“åŒ…æ–‡ä»¶æ ‘ä¸­ã€‚ ä¸ºå…¥å£èµ„æºåˆ›å»ºä¸€ä¸ªåŒ…ï¼Œå¹¶ä¸”ä¸ºåŠ¨æ€çš„ `import()` åˆ›å»ºå­åŒ…ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç æ‹†åˆ†çš„å‘ç”Ÿã€‚

å½“å¯¼å…¥ä¸åŒç±»å‹çš„èµ„æºæ—¶ï¼Œå…„å¼Ÿæ–‡ä»¶åŒ…ä¼šè¢«åˆ›å»ºï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ ä» JavaScript å¯¼å…¥ CSS æ–‡ä»¶ï¼Œå®ƒå°†è¢«æ”¾å…¥å…„å¼Ÿæ–‡ä»¶åŒ…åˆ°ç›¸åº”çš„ JavaScript ä¸­ã€‚

å¦‚æœä¸€ä¸ªèµ„æºéœ€è¦è¢«æ‰“åŒ…åˆ°å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œå®ƒä¼šè¢«æå‡åˆ°æ–‡ä»¶æŸæ ‘ä¸­æœ€è¿‘çš„å…¬å…±ç¥–å…ˆä¸­ï¼Œè¿™æ ·è¯¥èµ„æºå°±ä¸ä¼šè¢«å¤šæ¬¡æ‰“åŒ…ã€‚

3ã€æ‰“åŒ…

æ‰“åŒ…æ–‡ä»¶æ ‘è¢«æ„å»ºä¹‹åï¼Œæ¯ä¸ªåŒ…éƒ½ç”±ç‰¹å®šäºè¯¥æ–‡ä»¶ç±»å‹çš„ packager å†™å…¥æ–‡ä»¶ã€‚æ‰“åŒ…å™¨çŸ¥é“å¦‚ä½•å°†æ¯ä¸ªèµ„æºçš„ä»£ç åˆå¹¶åˆ°å¯ä»¥è®©æµè§ˆå™¨åŠ è½½çš„æœ€ç»ˆæ–‡ä»¶ä¸­ã€‚

#### ç‰¹ç‚¹
ä¼˜ç‚¹
- é›¶é…ç½®ï¼Œåªéœ€è¦å°†å®ƒæŒ‡å‘åº”ç”¨ç¨‹åºå…¥å£ç‚¹ï¼Œå°±èƒ½æ­£å¸¸å·¥ä½œ
- æ„å»ºå¿«é€Ÿï¼Œå…·æœ‰æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œå¯ä»¥ä¿å­˜æ¯ä¸ªæ–‡ä»¶çš„ç¼–è¯‘ç»“æœ
- æ‰“åŒ…é€Ÿåº¦å¿«

ç¼ºç‚¹ï¼š
- htmlä¸æ”¯æŒçƒ­æ›´æ–°
- ä¸æ”¯æŒtree sharking
- æ–°çš„æ‰“åŒ…å·¥å…·ï¼Œæ’ä»¶å’Œç”Ÿæ€æ²¡æœ‰webpackçš„æ”¯æŒåº¦å¥½

### webpack
èµ·æºäº2012å¹´ï¼Œç”¨äºè§£å†³å½“æ—¶ç°æœ‰å·¥å…·æœªè§£å†³çš„çš„ä¸€ä¸ªéš¾é¢˜ï¼šæ„å»ºå¤æ‚çš„å•é¡µåº”ç”¨ç¨‹åº(SPA)


### ä¸ºä»€ä¹ˆé€‰ç”¨webapck


æ‰“åŒ…å·¥å…· | é…ç½®éš¾åº¦ |  ç‰¹ç‚¹
---|--- | ---
FIS3 | æˆæœ¬é«˜ | è¾“å…¥è¾“å‡ºçµæ´»ï¼Œå¤§è€Œå…¨ï¼Œä½†åº”ç”¨åœºæ™¯å°´å°¬ 
gulp | ä¸­ç­‰ | æµå¼å¤„ç†
rollup | ä¸­ç­‰ | treeshakingã€ES6ã€ä½“ç§¯ç‰¹æ¯”å°
webpack | ä¸­ç­‰ | SPAã€ ä»£ç åˆ†å‰² ã€åŠŸèƒ½å¼ºå¤§
parcel | ä½ | é€Ÿåº¦å¿«,ä½†ç”Ÿæ€å’ŒåŠŸèƒ½ä¸å®Œå–„ |


## webapck å‘å±•å†å²
æ¥æ‰’ä¸€æ‰’webpackæ˜¯æ€ä¹ˆè¯ç”Ÿçš„ï¼Œwebpackæ˜¯æ˜¯ä¸€ä¸ªå¾·å›½äººåˆ›å»ºçš„ï¼Œè¿™ä¸ªå®¶ä¼™ä¸æ˜¯æå‰ç«¯çš„

![](http://h0.hucdn.com/open201944/e2cf29a56cb53ee6_823x444.png)

sokra  ä¸€å¼€å§‹æ˜¯ å†™ Java çš„,Java é‡Œé¢æœ‰ä¸ªå¾ˆå‡ºåçš„æŠ€æœ¯ å« GWTï¼ˆGoogle Web Toolkitï¼‰ï¼ŒGWT æ˜¯æŠŠ Java ä»£ç è½¬æ¢æˆ JavaScript ï¼Œä¹Ÿå°±æ˜¯è®©åç«¯æ¥å†™å‰ç«¯ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åœ¨ AST å±‚é¢å¯¹ä»£ç åšä¸€æˆè½¬æ¢ï¼ŒBabel ä¹Ÿæ˜¯å¹²è¿™ä»¶äº‹çš„ï¼Œä½†æ˜¯ GWT è¿™é—¨æŠ€æœ¯æ²¡æœ‰æµè¡Œèµ·æ¥ï¼Œåé¢ Google ä¹Ÿä¸æ¨å¹¿äº†ã€‚

GWT é‡Œé¢æœ‰ä¸ª feature å« ã€Œcode splittingã€ï¼Œäºæ˜¯  ä»–å½“æ—¶ç»™ç”¨æ¥åšå‰ç«¯é¡¹ç›® Bundle çš„ node.js åº“ modules-webmake æäº†ä¸€ä¸ª issue ï¼Œå¸Œæœ›ä»–ä»¬èƒ½å®ç°ï¼Œ ã€Œcode splittingã€å°±æ˜¯ Webpack ç°åœ¨æä¾›çš„ä¸»è¦åŠŸèƒ½ï¼Œä¹Ÿæ˜¯å½“ä»£å‰ç«¯çš„åŸºçŸ³

modules-webmake ç»´æŠ¤è€…ä¸€ç›´æ²¡æœ‰å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™ä¸ª issues ç°åœ¨è¿˜ open ç€ï¼Œå¤§å®¶å¯ä»¥ç‚¹è¿›å»çœ‹çœ‹ï¼Œsokra çš„å›å¤å¾ˆæœ‰æ„æ€çš„
äºæ˜¯ sokra å°± forkäº†ä¸€ä»½ modules-webmake ä»£ç  ï¼Œåœ¨githubä¸Šå¼€äº†ä¸€ä¸ªæ–°çš„é¡¹ç›® webpackï¼Œæ—¶é—´æ˜¯ 2012å¹´3æœˆ10å·ï¼Œè®°ä½è¿™ä¸ªä¼Ÿå¤§çš„æ—¥å­ï¼ŒWebpackè¿™ä¸ªä¼Ÿå¤§çš„é¡¹ç›®å°±è¿™æ ·è¯ç”Ÿäº†ï¼ï¼ï¼ï¼ï¼Œä¼°è®¡ sokra å½“æ—¶ä¹Ÿæ²¡æƒ³æ—¥å Webpack ä¼šè¿™ä¹ˆæµè¡Œï¼Œæˆä¸ºå‰ç«¯å¼€å‘çš„æ ‡é…
æ‰€ä»¥ Webpack æœ€å¼€å§‹çš„ åŠŸèƒ½ä¸»è¦æ˜¯ Bundleï¼Œç‰¹ç‚¹æ˜¯ã€Œcode splittingã€
çœ‹çœ‹ï¼Œ Webpack ä¹Ÿæ˜¯ fork å…¶ä»–é¡¹ç›®ï¼ŒBabel çš„æ ¸å¿ƒ @babel/core åº“ æ˜¯fork çš„ acorn åº“ï¼Œæ‰€ä»¥å¤§å®¶æ‹‰ä¸ª github åº“åˆ°æœ¬åœ°ï¼Œæ”¹æ”¹è‡ªå·±ç”¨ï¼Œä¸ç”¨ä¸å¥½æ„æ€
Webpack è¯ç”Ÿäº†ï¼Œä½†å®ƒæ˜¯æ€ä¹ˆæµè¡Œèµ·æ¥äº†ï¼Œè¿™ä¸ªä¹Ÿå¾ˆæœ‰æ„æ€,æˆ‘ä»¬æŠŠæ—¶é—´å›æ‹¨åˆ°2013å¹´ï¼Œè¿™ä¸€å¹´ï¼ŒReact å¼€æºäº†ï¼ŒReact æ˜¯ Facebook åœ¨ 2012å¹´å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªæ¡†æ¶ï¼ŒåŒå¹´ Facebook æ”¶è´­äº† Instagramï¼Œæ‰€ä»¥ Instagram ä¹Ÿæ˜¯ç”¨çš„ React ï¼ŒInstagramæ˜¯ä¸€ä¸ªå›¾ç‰‡çš„ç¤¾äº¤ç½‘ç«™ï¼Œå›¾ç‰‡è¿˜æ˜¯é«˜æ¸…çš„ï¼Œå¯¹é¡µé¢æ€§èƒ½è¦æ±‚é‚£æ˜¯ç›¸å½“é«˜çš„

åŸæ–‡å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://juejin.im/post/5d18b90e51882503221694af)

webpackç«èµ·æ¥ä¸»è¦æ˜¯å› ä¸ºSPAï¼Œè®©ä»–ä»¬

#### webpack1
- æ”¯æŒCMDå’ŒAMDï¼ŒåŒæ—¶æ‹¥æœ‰ä¸°å¯Œçš„pluginå’Œloaderï¼Œwebpacké€æ¸å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚

####  webpack2

- æ”¯æŒES Moduleï¼Œåˆ†æES Moduleä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œ
- webpack1å¿…é¡»å°†ES Moduleè½¬æ¢æˆCommonJSæ¨¡å—ï¼Œ2æ”¯æŒtree sharking

#### webpack3
- webpack3åšçš„å°±æ˜¯åœ¨2çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›
- æ–°çš„ç‰¹æ€§å¤§éƒ½å›´ç»•ES Moduleæå‡ºï¼Œå¦‚Scope Hoistingå’ŒMagic Commentï¼›
- webpack3ä»¥ä¸ŠåŸºæœ¬ä¸Šéƒ½å¯ä»¥è§£å†³es6æå‡ºçš„æ¨¡å—åŒ–

#### webpack4
- å¯ä»¥è§£å†³es6æ¨¡å—åŒ–ã€ export default / export import ã€‘
- æ›´å¤šä¸ªåŠŸèƒ½æ€§ pulginã€ æ’ä»¶ ã€‘ å’Œ loader ã€ è½¬æ¢å™¨ ã€‘
- å¹¶è¡Œæ‰“åŒ…
- webpack-cliä»webpackä¸­åˆ†ç¦»å‡ºæ¥äº†
- æ·»åŠ äº†modeæ¨¡å¼ï¼Œå€¼å¯é€‰æœ‰ä¸¤ä¸ª development å’Œ productionï¼Œå¯¹ä¸åŒçš„ç¯å¢ƒä»–ä¼šæä¾›ä¸åŒçš„ä¸€äº›é»˜è®¤é…ç½®ï¼Œ

### webpack3 è¿ç§»åˆ° webpack4
ç›®å‰åœ¨éœ€æ±‚å¼€å‘ä¸­ï¼Œé¢ä¸´å¾ˆå¤šçš„ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•å¿«é€Ÿçš„ä»webpack3è¿ç§»åˆ°webpack4

åŸºæœ¬æ¡ä»¶çš„å‡çº§

- nodeç‰ˆæœ¬>6.0  
- å‡çº§webpackï¼Œwebpackä»4.0èµ·ï¼Œæ‹†åˆ†æˆwebpackå’Œwebpack-cliä¸¤ä¸ªåŒ…ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¸è½½æ‰webpackï¼Œå†é‡æ–°å®‰è£…webpackå’Œwebpack-cli 
- modeï¼šwebpacké…ç½®æ–‡ä»¶å¿…é¡»å¢åŠ modeé€‰é¡¹
- ç¬¬ä¸‰æ–¹çš„æ’ä»¶å’Œloader


ç¬¬ä¸‰æ–¹çš„æ’ä»¶å’Œloaderæ˜¯webpackçš„å¼ºå¤§åŠŸèƒ½çš„ä¿è¯ï¼Œè¦å¯¹æ¯ä¸€ä¸ªæ’ä»¶å’Œloaderè¿›è¡Œç¡®è®¤æ˜¯å¦éœ€è¦å‡çº§ï¼Œå› ä¸ºå¯¹äºwebpackä¸åŒç‰ˆæœ¬çš„3å’Œ4ï¼ŒæŸäº›æ’ä»¶å’Œloaderå¯èƒ½ä¼šå‡ºé”™ï¼Œè¿™æ˜¯å‡çº§webpackä¸­å·¥ä½œé‡æ¯”è¾ƒå¤§åœ°æ–¹ï¼Œéœ€è¦å¯¹ç…§æ’ä»¶å’Œloaderçš„å®˜ç½‘çœ‹ä¹¦å¦éœ€è¦å‡çº§ã€‚




### webpack 5 æ–°ç‰¹æ€§

- æŒä¹…åŒ–ç¼“å­˜
- å¤šè¿›ç¨‹
- html cssæå‡ä¸ºä¸€ç­‰å…¬æ°‘
- æŒ‰éœ€åŠ è½½æ”¯æŒæ–‡ä»¶åæ¨¡å¼(å—ID)
- ä½¿ç”¨long-term cachingè§£å†³ç”Ÿäº§ç¯å¢ƒä¸‹moduleIds & chunkIdså˜åŒ–çš„é—®é¢˜
- ä¼˜åŒ–minSize&maxSizeçš„é…ç½®æ–¹å¼
- Node.js polyfills è‡ªåŠ¨åŠ è½½åŠŸèƒ½è¢«ç§»é™¤
- HMRåŠŸèƒ½ä¼˜åŒ–ï¼Œä»£ç å•ç‹¬æŠ½ç¦»å‡ºæ¥

#### æ‰“åŒ…ä½“ç§¯
å›¾æ¥æºäº[Webpack5.0 æ–°ç‰¹æ€§å°é²œå®æˆ˜ ğŸ¦€ğŸ¦€](https://juejin.im/post/5c8761925188251a0844d3a4)

webapck4æ‰“åŒ…
> ![](http://h0.hucdn.com/open201943/bb3bd37074b0911c_1016x521.png)

webapck5æ‰“åŒ…
> ![](http://h0.hucdn.com/open201943/58c0b8c11c27cdd8_1019x525.png)


## webpackåŸºæœ¬é…ç½®

webpack 5å¤§åŸºæœ¬é…ç½®
- entry
- output
- loader
- plugin
- mode

webpack.config.js
```js
const path = require('path');

module.exports = {
    entry: './src/index.js',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: 'main.js'
    },
    mode: 'production',
    module: {
        rules: [
            {
                test: '/\.txt$/',
                use: 'raw-loader'
            }
        ],
    },
    plugin: [
        new HtmlWebpackPlugin({
            template: './public/index.html'
        })
    ]
}
```

è¯¦ç»†é…ç½®è§webpackå®˜ç½‘ï¼Œè¿™é‡Œç®€å•åˆ—ä¸¾ä¸€ä¸‹ï¼š

### entry å’Œ output
- å…¥å£ï¼šæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹
- å‡ºå£ï¼šæ§åˆ¶ webpack å¦‚ä½•å‘ç¡¬ç›˜å†™å…¥ç¼–è¯‘æ–‡ä»¶

### loader
å› ä¸ºwebpack è‡ªèº«åªç†è§£ JavaScriptã€‚
loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚

åœ¨ webpack çš„é…ç½®ä¸­ loader æœ‰ä¸¤ä¸ªç›®æ ‡ï¼š
1. test å±æ€§ï¼Œç”¨äºæ‰¾åˆ° å‡ºéœ€è¦è¢« loader è¿›è¡Œè½¬æ¢ çš„æŸä¸ªæˆ–æŸäº›æ–‡ä»¶ã€‚
2. use å±æ€§ï¼Œè¡¨ç¤ºè¿›è¡Œè½¬æ¢æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ª loader

![](http://h0.hucdn.com/open201944/3e995efb464c6e28_373x205.png)

å›¾ä¸­çš„é…ç½® å‘Šè¯‰ webpack ç¼–è¯‘å™¨(compiler) å¦‚ä¸‹ä¿¡æ¯ï¼š
â€œå˜¿ï¼Œwebpack ç¼–è¯‘å™¨ï¼Œå½“ä½ ç¢°åˆ°ã€Œåœ¨ require()/import è¯­å¥ä¸­è¢«è§£æä¸º '.js' çš„è·¯å¾„ã€æ—¶ï¼Œåœ¨ä½ å¯¹å®ƒæ‰“åŒ…ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ babel-loader è½¬æ¢ä¸€ä¸‹ã€‚


ä¸‰ç§ä½¿ç”¨loaderçš„æ–¹æ³•ï¼š

- åŸºæœ¬é…ç½®(æ¨è)
```js
module: {
    rules: [
        {
            test: /.js$/,
            use: 'babel-loader',
        },
        {
            test: /.less$/,
            use: [
                'style-loader',
                'css-loader',
                'less-loader',
            ]
        }
    ]
}
```
loader æ”¯æŒé“¾å¼ä¼ é€’ã€‚èƒ½å¤Ÿå¯¹èµ„æºä½¿ç”¨æµæ°´çº¿(pipeline)ã€‚ä¸€ç»„é“¾å¼çš„ loader å°†æŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œã€‚loader é“¾ä¸­çš„ç¬¬ä¸€ä¸ª loader è¿”å›å€¼ç»™ä¸‹ä¸€ä¸ª loaderã€‚åœ¨æœ€åä¸€ä¸ª loaderï¼Œè¿”å› webpack æ‰€é¢„æœŸçš„ JavaScriptã€‚

- å†…è”
```js
import Styles from 'style-loader!css-loader?modules!./styles.css';
```

- CLI

```js
webpack --module-bind 'css=style-loader!css-loader'
```

### plugins
loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚

æ’ä»¶ç›®çš„åœ¨äºè§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹




## å‚è€ƒ
- [å‰ç«¯æ„å»ºå·¥å…·æ¼«è°ˆï¼Œfis3ã€webpackã€rollup.js](https://div.io/topic/1724)
- [Tree-Shakingæ€§èƒ½ä¼˜åŒ–å®è·µ - åŸç†ç¯‡](https://zhuanlan.zhihu.com/p/32554436)
- [Gulp](https://www.gulpjs.com.cn/docs/getting-started/working-with-files/)
- [FIS3](https://fis.baidu.com/fis3/docs/beginning/intro.html)
- [Parcel](https://www.html.cn/doc/parcel/assets.html)
- [Rollup](https://rollupjs.org/guide/en/)
- [Webpack è¯ç”Ÿè®°](https://juejin.im/post/5d18b90e51882503221694af)